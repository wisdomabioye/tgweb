{"version":3,"sources":["../../src/service/dc-configurator.js"],"names":["sslSubdomains","devDC","id","host","port","prodDC","portString","findById","chooseServer","chosenServers","dev","webogram","dcList","dcID","upload","choosen","chosenServer","subdomain","path","dcOption"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,gBAAgB,CAAC,OAAD,EAAU,OAAV,EAAmB,QAAnB,EAA6B,OAA7B,EAAsC,OAAtC,CAAtB;;AAEA,IAAMC,QAAQ,CACZ,EAAEC,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAkCC,MAAM,EAAxC,EADY,EAEZ,EAAEF,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAkCC,MAAM,EAAxC,EAFY,EAGZ,EAAEF,IAAI,CAAN,EAASC,MAAM,iBAAf,EAAkCC,MAAM,EAAxC,EAHY,CAAd;;AAMA,IAAMC,SAAS,CACb,EAAEH,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAkCC,MAAM,EAAxC,EADa,EAEb,EAAEF,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAkCC,MAAM,EAAxC,EAFa,EAGb,EAAEF,IAAI,CAAN,EAASC,MAAM,iBAAf,EAAkCC,MAAM,EAAxC,EAHa,EAIb,EAAEF,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAkCC,MAAM,EAAxC,EAJa,EAKb,EAAEF,IAAI,CAAN,EAASC,MAAM,eAAf,EAAkCC,MAAM,EAAxC,EALa,CAAf;;AAQA,IAAME,aAAa,CAAC,EAAEF,OAAO,EAAT,EAAD,KAAmBA,SAAS,EAAT,GAClC,EADkC,GAEjC,IAAGA,IAAK,EAFb;;AAIA,IAAMG,WAAW,oBAAM,sBAAO,IAAP,CAAN,iBAAjB;;AAEO,IAAMC,sCAAe,CAACC,aAAD,EAAgB;AAC1CC,QAAM,KADoC;AAE1CC,aAAW,KAF+B;AAG1CC,WAASF,MACLT,KADK,GAELI;AALsC,IAMtC,EANsB,KAO1B,CAACQ,IAAD,EAAOC,SAAS,KAAhB,KAA0B;AACxB,MAAMC,UAAU,oBAAKF,IAAL,CAAhB;AACA,MAAI,mBAAIA,IAAJ,EAAUJ,aAAV,CAAJ,EAA8B,OAAOM,QAAQN,aAAR,CAAP;AAC9B,MAAIO,eAAe,KAAnB;;AAGA,MAAIL,QAAJ,EAAc;AACZ,QAAMM,YAAYjB,cAAca,OAAO,CAArB,KAA2BC,SAAS,IAAT,GAAgB,EAA3C,CAAlB;AACA,QAAMI,OAAOR,MACT,YADS,GAET,OAFJ;AAGAM,mBAAgB,WAAWC,SAAW,qBAAqBC,IAAM,EAAjE;AACA,WAAOF,YAAP,CANY,CAMQ;AACrB;AACD,MAAMG,WAAWZ,SAASM,IAAT,EAAeD,MAAf,CAAjB;AACA,MAAIO,QAAJ,EACEH,eAAgB,UAAUG,SAAShB,IAAM,GAAEG,WAAWa,QAAX,CAAqB,QAAhE;AACFV,gBAAcI,IAAd,IAAsBG,YAAtB;;AAEA,SAAOD,QAAQN,aAAR,CAAP;AACD,CA3BI","file":"dc-configurator.js","sourcesContent":["import has from 'ramda/src/has'\nimport propEq from 'ramda/src/propEq'\nimport find from 'ramda/src/find'\nimport pipe from 'ramda/src/pipe'\nimport prop from 'ramda/src/prop'\n\nconst sslSubdomains = ['pluto', 'venus', 'aurora', 'vesta', 'flora']\n\nconst devDC = [\n  { id: 1, host: '149.154.175.10',  port: 80 },\n  { id: 2, host: '149.154.167.40',  port: 80 },\n  { id: 3, host: '149.154.175.117', port: 80 }\n]\n\nconst prodDC = [\n  { id: 1, host: '149.154.175.50',  port: 80 },\n  { id: 2, host: '149.154.167.51',  port: 80 },\n  { id: 3, host: '149.154.175.100', port: 80 },\n  { id: 4, host: '149.154.167.91',  port: 80 },\n  { id: 5, host: '149.154.171.5',   port: 80 }\n]\n\nconst portString = ({ port = 80 }) => port === 80\n  ? ''\n  : `:${port}`\n\nconst findById = pipe( propEq('id'), find )\n\nexport const chooseServer = (chosenServers, {\n  dev = false,\n  webogram = false,\n  dcList = dev\n    ? devDC\n    : prodDC\n  } = {}) =>\n  (dcID, upload = false) => {\n    const choosen = prop(dcID)\n    if (has(dcID, chosenServers)) return choosen(chosenServers)\n    let chosenServer = false\n\n\n    if (webogram) {\n      const subdomain = sslSubdomains[dcID - 1] + (upload ? '-1' : '')\n      const path = dev\n        ? 'apiw_test1'\n        : 'apiw1'\n      chosenServer = `https://${ subdomain }.web.telegram.org/${ path }`\n      return chosenServer //TODO Possibly bug. Isn't it necessary? chosenServers[dcID] = chosenServer\n    }\n    const dcOption = findById(dcID)(dcList)\n    if (dcOption)\n      chosenServer = `http://${ dcOption.host }${portString(dcOption)}/apiw1`\n    chosenServers[dcID] = chosenServer\n\n    return choosen(chosenServers)\n  }"]}